<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>PAUSE OSTIE â€” Gestionnaire</title>
<link href="https://fonts.googleapis.com/css2?family=Bebas+Neue&family=Poppins:wght@400;500;600;700;800&display=swap" rel="stylesheet">
<style>
  :root {
    --bg: #12121a;
    --surface: #1e1e2a;
    --surface2: #26263a;
    --border: #44445e;
    --accent: #ff6030;
    --accent2: #ff8c5a;
    --warn: #ffd040;
    --green: #3dffa0;
    --blue: #7dd6ff;
    --text: #ffffff;
    --text-dim: #c0c0e0;
    --text-dimmer: #7878a0;
    --font-display: 'Bebas Neue', sans-serif;
    --font: 'Poppins', sans-serif;
  }
  *, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }

  body {
    background: var(--bg);
    color: var(--text);
    font-family: var(--font);
    min-height: 100vh;
    overflow-x: hidden;
  }

  body::before {
    content: '';
    position: fixed; inset: 0;
    background-image:
      linear-gradient(rgba(255,69,0,0.025) 1px, transparent 1px),
      linear-gradient(90deg, rgba(255,69,0,0.025) 1px, transparent 1px);
    background-size: 48px 48px;
    pointer-events: none; z-index: 0;
  }

  /* â•â• LOGIN â•â• */
  #page-login {
    position: fixed; inset: 0;
    display: flex; align-items: center; justify-content: center;
    z-index: 100; background: var(--bg);
  }
  .login-box {
    position: relative; width: 400px;
    background: var(--surface); border: 1px solid var(--border);
    padding: 52px 44px; animation: fadeUp 0.5s ease;
  }
  .login-box::before {
    content: ''; position: absolute; top: 0; left: 0; right: 0; height: 3px;
    background: linear-gradient(90deg, var(--accent), var(--accent2), transparent);
  }
  .login-logo {
    font-family: var(--font-display);
    font-size: 48px; letter-spacing: 5px; color: var(--accent);
    line-height: 1; margin-bottom: 4px;
  }
  .login-sub {
    font-size: 11px; font-weight: 500; color: var(--text-dim);
    letter-spacing: 3px; text-transform: uppercase; margin-bottom: 44px;
  }
  .field-group { margin-bottom: 20px; }
  .field-group label {
    display: block; font-size: 10px; font-weight: 600;
    letter-spacing: 2px; color: var(--text-dim); text-transform: uppercase; margin-bottom: 8px;
  }
  .field-group input {
    width: 100%; background: var(--bg); border: 1px solid var(--border);
    color: var(--text); font-family: var(--font); font-size: 15px; font-weight: 500;
    padding: 13px 16px; outline: none; transition: border-color 0.2s;
  }
  .field-group input:focus { border-color: var(--accent); }
  .btn-primary {
    width: 100%; background: var(--accent); color: #fff; border: none;
    font-family: var(--font-display); font-size: 22px; letter-spacing: 4px;
    padding: 15px; cursor: pointer; transition: all 0.2s; margin-top: 8px;
  }
  .btn-primary:hover { background: var(--accent2); }
  .btn-primary:active { transform: scale(0.98); }
  .login-error { font-size: 12px; font-weight: 500; color: var(--accent); margin-top: 14px; text-align: center; min-height: 18px; }

  /* â•â• APP â•â• */
  #page-app { display: none; position: relative; z-index: 1; min-height: 100vh; }

  .app-header {
    display: flex; align-items: center; justify-content: space-between;
    padding: 18px 32px; border-bottom: 1px solid var(--border);
    background: var(--surface); position: sticky; top: 0; z-index: 50;
  }
  .header-logo { font-family: var(--font-display); font-size: 30px; letter-spacing: 5px; color: var(--accent); line-height: 1; }
  .header-logo span { font-family: var(--font); font-size: 12px; font-weight: 600; color: var(--text-dim); letter-spacing: 2px; display: block; margin-top: 2px; }
  .header-right { display: flex; align-items: center; gap: 12px; }
  .pause-counter {
    font-size: 13px; font-weight: 600; color: var(--text-dim);
    padding: 8px 16px; border: 1px solid var(--border);
  }
  .pause-counter strong { color: var(--accent); font-size: 20px; font-weight: 800; }
  .btn-icon {
    background: none; border: 1px solid var(--border); color: var(--text-dim);
    font-family: var(--font); font-size: 12px; font-weight: 600;
    letter-spacing: 1px; padding: 8px 14px; cursor: pointer; transition: all 0.2s; text-transform: uppercase;
  }
  .btn-icon:hover { border-color: var(--accent); color: var(--accent); }

  /* â•â• TABS â•â• */
  .tabs { display: flex; border-bottom: 1px solid var(--border); padding: 0 32px; background: var(--surface); }
  .tab {
    font-family: var(--font); font-size: 13px; font-weight: 600;
    letter-spacing: 1px; padding: 16px 24px; cursor: pointer;
    border-bottom: 3px solid transparent; color: var(--text-dim); transition: all 0.2s; user-select: none;
    text-transform: uppercase;
  }
  .tab.active { color: var(--text); border-bottom-color: var(--accent); }
  .tab:hover:not(.active) { color: var(--text); }

  .content { padding: 36px 32px; max-width: 960px; margin: 0 auto; }
  .tab-content { display: none; }
  .tab-content.active { display: block; animation: fadeUp 0.3s ease; }

  .section-title { font-family: var(--font-display); font-size: 34px; letter-spacing: 4px; color: var(--text); margin-bottom: 4px; }
  .section-sub { font-size: 12px; font-weight: 600; color: var(--text-dim); letter-spacing: 2px; text-transform: uppercase; margin-bottom: 32px; }

  /* â•â• CAPACITY â•â• */
  .capacity-bar { display: flex; gap: 8px; margin-bottom: 28px; align-items: center; }
  .cap-dot {
    width: 38px; height: 38px; border: 2px solid var(--border);
    display: flex; align-items: center; justify-content: center;
    font-size: 14px; font-weight: 700; color: var(--text-dimmer); transition: all 0.3s;
  }
  .cap-dot.used { border-color: var(--accent); background: rgba(255,69,0,0.15); color: var(--accent); }
  .cap-label { font-size: 13px; font-weight: 700; color: var(--text); margin-left: 10px; text-transform: uppercase; letter-spacing: 1px; }

  /* â•â• SEND FORM â•â• */
  .send-card { background: var(--surface); border: 1px solid var(--border); padding: 36px; position: relative; }
  .send-card::before { content: ''; position: absolute; top: 0; left: 0; right: 0; height: 2px; background: linear-gradient(90deg, var(--accent), transparent); }
  .input-row { display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-bottom: 24px; }
  .input-block label { display: block; font-size: 11px; font-weight: 700; letter-spacing: 2px; color: var(--text); text-transform: uppercase; margin-bottom: 8px; }
  .input-block input {
    width: 100%; background: var(--bg); border: 1px solid var(--border);
    color: var(--text); font-family: var(--font); font-size: 15px; font-weight: 500;
    padding: 12px 16px; outline: none; transition: border-color 0.2s;
  }
  .input-block input:focus { border-color: var(--accent); }

  .preview-agent {
    background: var(--bg); border: 1px solid var(--border); border-left: 3px solid var(--green);
    padding: 16px 20px; margin-bottom: 24px; display: none; animation: fadeUp 0.2s ease;
  }
  .preview-agent.visible { display: block; }
  .preview-name { font-size: 19px; font-weight: 700; color: var(--text); margin-bottom: 4px; }
  .preview-info { font-size: 12px; font-weight: 500; color: var(--text-dim); letter-spacing: 0.5px; }

  .btn-send {
    width: 100%; background: var(--accent); color: #fff; border: none;
    font-family: var(--font-display); font-size: 26px; letter-spacing: 5px;
    padding: 18px; cursor: pointer; transition: all 0.2s;
  }
  .btn-send:hover:not(:disabled) { background: var(--accent2); }
  .btn-send:disabled { background: var(--text-dimmer); cursor: not-allowed; color: var(--text-dim); }
  .btn-send:active:not(:disabled) { transform: scale(0.99); }
  .send-warning { font-size: 12px; font-weight: 600; color: var(--warn); text-align: center; margin-top: 12px; min-height: 18px; letter-spacing: 0.5px; }

  /* â•â• DASHBOARD â•â• */
  .dash-empty { text-align: center; padding: 80px 0; color: var(--text-dimmer); font-size: 14px; font-weight: 600; letter-spacing: 2px; text-transform: uppercase; }
  .dash-empty .big { font-size: 72px; margin-bottom: 16px; }
  .agent-list { display: flex; flex-direction: column; gap: 12px; }

  .agent-card {
    background: var(--surface); border: 1px solid var(--border);
    padding: 20px 24px; display: flex; align-items: center; justify-content: space-between;
    position: relative; animation: slideIn 0.3s ease;
  }
  .agent-card::before { content: ''; position: absolute; left: 0; top: 0; bottom: 0; width: 4px; background: var(--green); }
  .agent-card.warning::before { background: var(--warn); }
  .agent-card.overtime::before { background: var(--accent); animation: pulse 1s infinite; }

  .agent-left { display: flex; flex-direction: column; gap: 4px; flex: 1; }
  .agent-num { font-size: 11px; font-weight: 700; color: var(--text-dim); letter-spacing: 2px; text-transform: uppercase; }
  .agent-name { font-size: 20px; font-weight: 700; color: var(--text); }
  .agent-meta { font-size: 12px; font-weight: 500; color: var(--text-dim); }
  .agent-timestamps { font-size: 12px; font-weight: 500; color: var(--text-dim); margin-top: 4px; }

  .agent-right { display: flex; align-items: center; gap: 20px; }
  .agent-timer { text-align: right; }
  .timer-label { font-size: 11px; font-weight: 700; color: var(--text); letter-spacing: 2px; text-transform: uppercase; margin-bottom: 4px; }
  .timer-value { font-family: var(--font-display); font-size: 36px; letter-spacing: 2px; color: var(--green); transition: color 0.3s; line-height: 1; }
  .timer-value.warning { color: var(--warn); }
  .timer-value.overtime { color: var(--accent); animation: pulse 1s infinite; }

  .btn-recall {
    background: var(--green); border: none; color: #000;
    font-family: var(--font); font-size: 12px; font-weight: 800;
    letter-spacing: 1px; padding: 10px 18px; cursor: pointer; transition: all 0.2s; text-transform: uppercase;
  }
  .btn-recall:hover { background: #00ff88; transform: scale(1.04); }

  /* â•â• HISTORIQUE â•â• */
  .history-list { display: flex; flex-direction: column; gap: 8px; margin-top: 8px; }
  .history-card {
    background: var(--surface2); border: 1px solid var(--border); border-left: 4px solid var(--blue);
    padding: 14px 20px; display: flex; align-items: center; justify-content: space-between;
    animation: fadeUp 0.3s ease;
  }
  .history-left { display: flex; flex-direction: column; gap: 3px; }
  .history-name { font-size: 16px; font-weight: 700; color: var(--text); }
  .history-meta { font-size: 11px; font-weight: 500; color: var(--text-dim); }
  .history-times { font-size: 12px; font-weight: 500; color: var(--text-dim); }
  .history-right { text-align: right; }
  .history-duration { font-family: var(--font-display); font-size: 28px; color: var(--blue); letter-spacing: 2px; }
  .history-label { font-size: 11px; font-weight: 700; color: var(--text-dim); text-transform: uppercase; letter-spacing: 1px; }

  /* â•â• ADMIN â•â• */
  .admin-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 24px; margin-bottom: 32px; }
  .admin-card { background: var(--surface); border: 1px solid var(--border); padding: 28px; position: relative; }
  .admin-card::before { content: ''; position: absolute; top: 0; left: 0; right: 0; height: 2px; background: linear-gradient(90deg, var(--warn), transparent); }
  .admin-card h3 { font-family: var(--font-display); font-size: 22px; letter-spacing: 3px; margin-bottom: 20px; }
  .user-list { display: flex; flex-direction: column; gap: 8px; margin-bottom: 16px; max-height: 200px; overflow-y: auto; }
  .user-item {
    display: flex; align-items: center; justify-content: space-between;
    background: var(--bg); padding: 10px 14px; border: 1px solid var(--border);
    font-size: 13px; font-weight: 500; color: var(--text-dim);
  }
  .user-item strong { color: var(--text); font-weight: 700; }
  .user-role { font-size: 10px; font-weight: 600; color: var(--text-dimmer); letter-spacing: 1px; text-transform: uppercase; }
  .btn-del { background: none; border: none; color: var(--text-dimmer); cursor: pointer; font-size: 18px; padding: 2px 6px; transition: color 0.2s; }
  .btn-del:hover { color: var(--accent); }
  .add-user-form { display: flex; flex-direction: column; gap: 10px; }
  .add-user-form input {
    background: var(--bg); border: 1px solid var(--border); color: var(--text);
    font-family: var(--font); font-size: 14px; font-weight: 500;
    padding: 10px 14px; outline: none; transition: border-color 0.2s;
  }
  .add-user-form input:focus { border-color: var(--warn); }
  .btn-add {
    background: none; border: 1px solid var(--warn); color: var(--warn);
    font-family: var(--font); font-size: 14px; font-weight: 700;
    letter-spacing: 1px; padding: 10px; cursor: pointer; transition: all 0.2s; text-transform: uppercase;
  }
  .btn-add:hover { background: var(--warn); color: var(--bg); }

  .sheets-card { background: var(--surface); border: 1px solid var(--border); padding: 28px; position: relative; margin-bottom: 24px; }
  .sheets-card::before { content: ''; position: absolute; top: 0; left: 0; right: 0; height: 2px; background: linear-gradient(90deg, #4ade80, transparent); }
  .sheets-card h3 { font-family: var(--font-display); font-size: 22px; letter-spacing: 3px; margin-bottom: 8px; }
  .sheets-card p { font-size: 12px; font-weight: 500; color: var(--text-dim); line-height: 1.8; margin-bottom: 16px; }
  .sheets-url-display {
    background: var(--bg); border: 1px solid var(--border);
    padding: 12px 16px; font-size: 12px; font-weight: 500; color: var(--green);
    word-break: break-all; margin-bottom: 12px;
  }
  .status-msg { font-size: 12px; font-weight: 600; padding: 10px 14px; margin-top: 12px; letter-spacing: 0.5px; display: none; }
  .status-msg.ok { background: rgba(0,230,118,0.08); border: 1px solid var(--green); color: var(--green); display: block; }
  .status-msg.err { background: rgba(255,69,0,0.08); border: 1px solid var(--accent); color: var(--accent); display: block; }

  /* â•â• NOTIF â•â• */
  .notif {
    position: fixed; bottom: 24px; right: 24px; background: var(--surface);
    border: 1px solid var(--border); border-left: 4px solid var(--green);
    padding: 16px 20px; font-size: 13px; font-weight: 600; color: var(--text);
    z-index: 200; animation: fadeUp 0.3s ease; max-width: 320px;
  }
  .notif.err { border-left-color: var(--accent); }
  .notif.warn { border-left-color: var(--warn); }

  /* â•â• MODAL â•â• */
  .modal-overlay { position: fixed; inset: 0; background: rgba(0,0,0,0.85); z-index: 150; display: none; align-items: center; justify-content: center; }
  .modal-overlay.open { display: flex; }
  .modal { background: #2a2a3e; border: 2px solid var(--border); padding: 40px; width: 460px; animation: fadeUp 0.3s ease; }
  .modal h3 { font-family: var(--font-display); font-size: 28px; letter-spacing: 3px; margin-bottom: 12px; }
  .modal p { font-size: 15px; font-weight: 500; color: var(--text); line-height: 1.9; margin-bottom: 28px; }
  .modal-btns { display: flex; gap: 12px; }
  .btn-confirm { flex: 1; background: var(--green); border: none; color: #000; font-family: var(--font); font-size: 15px; font-weight: 800; letter-spacing: 1px; padding: 13px; cursor: pointer; transition: all 0.2s; text-transform: uppercase; }
  .btn-confirm:hover { background: #00ff88; }
  .btn-cancel { flex: 1; background: none; border: 1px solid var(--border); color: var(--text-dim); font-family: var(--font); font-size: 15px; font-weight: 700; letter-spacing: 1px; padding: 13px; cursor: pointer; transition: all 0.2s; text-transform: uppercase; }
  .btn-cancel:hover { border-color: var(--text); color: var(--text); }

  .hidden { display: none !important; }

  @keyframes fadeUp { from { opacity: 0; transform: translateY(14px); } to { opacity: 1; transform: translateY(0); } }
  @keyframes slideIn { from { opacity: 0; transform: translateX(-16px); } to { opacity: 1; transform: translateX(0); } }
  @keyframes pulse { 0%, 100% { opacity: 1; } 50% { opacity: 0.45; } }
  ::-webkit-scrollbar { width: 6px; }
  ::-webkit-scrollbar-track { background: var(--bg); }
  ::-webkit-scrollbar-thumb { background: var(--border); }

  @media (max-width: 650px) {
    .admin-grid, .input-row { grid-template-columns: 1fr; }
    .content { padding: 20px 14px; }
    .app-header, .tabs { padding-left: 16px; padding-right: 16px; }
    .agent-right { gap: 10px; }
    .timer-value { font-size: 26px; }
  }
</style>
</head>
<body>

<!-- â•â• LOGIN â•â• -->
<div id="page-login">
  <div class="login-box">
    <div class="login-logo">PAUSE</div>
    <div class="login-sub">Gestionnaire OSTIE â€” AccÃ¨s restreint</div>
    <div class="field-group">
      <label>Identifiant</label>
      <input type="text" id="login-user" placeholder="admin" autocomplete="off">
    </div>
    <div class="field-group">
      <label>Mot de passe</label>
      <input type="password" id="login-pass" placeholder="â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢">
    </div>
    <button class="btn-primary" onclick="doLogin()">CONNEXION</button>
    <div class="login-error" id="login-error"></div>
  </div>
</div>

<!-- â•â• APP â•â• -->
<div id="page-app">
  <header class="app-header">
    <div class="header-logo">
      PAUSE OSTIE
      <span>SystÃ¨me de suivi â€” sync en direct</span>
    </div>
    <div class="header-right">
      <div class="pause-counter">EN PAUSE : <strong id="hdr-count">0</strong> / 5</div>
      <button class="btn-icon hidden" id="btn-admin-tab" onclick="switchTab('admin')">âš™ ADMIN</button>
      <button class="btn-icon" onclick="doLogout()">â» DÃ‰CO</button>
    </div>
  </header>

  <div class="tabs">
    <div class="tab active" onclick="switchTab('send')" data-tab="send">â†‘ ENVOYER EN PAUSE</div>
    <div class="tab" onclick="switchTab('dash')" data-tab="dash">â± EN COURS</div>
    <div class="tab" onclick="switchTab('history')" data-tab="history">ğŸ“‹ HISTORIQUE SESSION</div>
    <div class="tab hidden" data-tab="admin" onclick="switchTab('admin')">âš™ ADMIN</div>
  </div>

  <div class="content">

    <!-- SEND -->
    <div class="tab-content active" id="tab-send">
      <div class="section-title">ENVOYER EN PAUSE</div>
      <div class="section-sub">Saisir le matricule â€” max 5 agents simultanÃ©ment</div>
      <div class="capacity-bar" id="capacity-bar"></div>
      <div class="send-card">
        <div class="input-row">
          <div class="input-block">
            <label>Matricule</label>
            <input type="text" id="input-matricule" placeholder="ex: 10234" maxlength="10"
              oninput="onMatriculeInput(this.value)" onkeydown="if(event.key==='Enter')sendPause()">
          </div>
          <div class="input-block">
            <label>Note (optionnel)</label>
            <input type="text" id="input-note" placeholder="ex: salle de pause" maxlength="40">
          </div>
        </div>
        <div class="preview-agent" id="preview-agent">
          <div class="preview-name" id="preview-name">â€”</div>
          <div class="preview-info" id="preview-info">â€”</div>
        </div>
        <button class="btn-send" id="btn-send" onclick="sendPause()" disabled>
          ENVOYER EN PAUSE
        </button>
        <div class="send-warning" id="send-warning"></div>
      </div>
    </div>

    <!-- DASH -->
    <div class="tab-content" id="tab-dash">
      <div class="section-title">EN COURS</div>
      <div class="section-sub">Agents actuellement en pause â€” mise Ã  jour toutes les 5 s</div>
      <div id="dash-list">
        <div class="dash-empty"><div class="big">â˜•</div>Aucun agent en pause</div>
      </div>
    </div>

    <!-- HISTORY -->
    <div class="tab-content" id="tab-history">
      <div class="section-title">HISTORIQUE SESSION</div>
      <div class="section-sub">Pauses terminÃ©es depuis votre connexion</div>
      <div id="history-list">
        <div class="dash-empty"><div class="big">ğŸ“‹</div>Aucune pause terminÃ©e</div>
      </div>
    </div>

    <!-- ADMIN -->
    <div class="tab-content hidden" id="tab-admin">
      <div class="section-title">ADMINISTRATION</div>
      <div class="section-sub">Gestion des accÃ¨s et statut de connexion</div>

      <div class="sheets-card">
        <h3>CONNEXION GOOGLE SHEETS</h3>
        <p>URL Apps Script configurÃ©e et active pour tous les utilisateurs :</p>
        <div class="sheets-url-display" id="sheets-url-display">â€”</div>
        <div class="status-msg ok" id="sheets-status">âœ“ URL configurÃ©e automatiquement â€” sync actif</div>
      </div>

      <div class="admin-grid">
        <div class="admin-card">
          <h3>UTILISATEURS</h3>
          <div class="user-list" id="user-list"></div>
          <div class="add-user-form">
            <input type="text" id="new-username" placeholder="Nom d'utilisateur" autocomplete="off">
            <input type="password" id="new-password" placeholder="Mot de passe" autocomplete="off">
            <button class="btn-add" onclick="addUser()">+ AJOUTER</button>
          </div>
        </div>
        <div class="admin-card">
          <h3>STATISTIQUES SESSION</h3>
          <div style="font-size:13px;font-weight:500;color:var(--text-dim);line-height:2.6;">
            <div>ConnectÃ© : <span id="stat-user" style="color:var(--text);font-weight:700;">â€”</span></div>
            <div>En pause maintenant : <span id="stat-count" style="color:var(--accent);font-weight:800;">0</span> / 5</div>
            <div>Pauses terminÃ©es : <span id="stat-total" style="color:var(--warn);font-weight:800;">0</span></div>
            <div>Agents dans la base : <span id="stat-agents" style="color:var(--green);font-weight:800;">0</span></div>
          </div>
        </div>
      </div>
    </div>

  </div>
</div>

<!-- MODAL -->
<div class="modal-overlay" id="modal">
  <div class="modal">
    <h3 id="modal-title">CONFIRMATION</h3>
    <p id="modal-body">ÃŠtes-vous sÃ»r ?</p>
    <div class="modal-btns">
      <button class="btn-confirm" id="modal-confirm">CONFIRMER</button>
      <button class="btn-cancel" onclick="closeModal()">ANNULER</button>
    </div>
  </div>
</div>

<script>
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// CONFIG â€” URL PARTAGÃ‰E POUR TOUS LES UTILISATEURS
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
const SHEETS_URL = 'https://script.google.com/macros/s/AKfycbwpAouM8kODaeiWh1c4-3vK8RcU2TLEqUNb0-1cXIidHUCIZ1HeaWRqCgBk5t9f4iNd/exec';
const MAX_PAUSE = 5;
const POLL_MS   = 5000;

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// STATE
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
let currentUser  = null;
let agentsDB     = {};
let pauseList    = [];   // pauses actives (source = Sheets)
let historyList  = [];   // pauses terminÃ©es cette session
let timerInterval = null;
let pollInterval  = null;
let modalCb       = null;

// DÃ©mo si Sheets ne rÃ©pond pas
const DEMO = {
  '10001': { nom: 'Marie Tremblay',        equipe: 'Service client' },
  '10002': { nom: 'Jean-FranÃ§ois Gagnon',  equipe: 'Support technique' },
  '10003': { nom: 'Sophie Bouchard',       equipe: 'Ventes' },
  '10004': { nom: 'Marc-AndrÃ© CÃ´tÃ©',       equipe: 'Service client' },
  '10005': { nom: 'Isabelle Roy',          equipe: 'Ressources humaines' },
  '10006': { nom: 'Philippe Leblanc',      equipe: 'Support technique' },
  '10007': { nom: 'AmÃ©lie Fortin',         equipe: 'Ventes' },
  '10008': { nom: 'David Lavoie',          equipe: 'Service client' },
};

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// STORAGE USERS
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function getUsers() {
  const raw = localStorage.getItem('pause_users');
  if (!raw) {
    const d = [{ username: 'admin', password: 'admin', role: 'admin' }];
    localStorage.setItem('pause_users', JSON.stringify(d));
    return d;
  }
  return JSON.parse(raw);
}
function saveUsers(u) { localStorage.setItem('pause_users', JSON.stringify(u)); }

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// LOGIN / LOGOUT
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
document.getElementById('login-pass').addEventListener('keydown', e => { if (e.key === 'Enter') doLogin(); });
document.getElementById('login-user').addEventListener('keydown', e => { if (e.key === 'Enter') document.getElementById('login-pass').focus(); });

function doLogin() {
  const u = document.getElementById('login-user').value.trim();
  const p = document.getElementById('login-pass').value;
  const found = getUsers().find(x => x.username === u && x.password === p);
  if (!found) {
    document.getElementById('login-error').textContent = 'âœ• Identifiants incorrects';
    document.getElementById('login-pass').value = '';
    return;
  }
  currentUser = found;
  document.getElementById('page-login').style.display = 'none';
  document.getElementById('page-app').style.display = 'block';
  if (found.role === 'admin') {
    document.getElementById('btn-admin-tab').classList.remove('hidden');
    document.querySelectorAll('[data-tab="admin"]').forEach(el => el.classList.remove('hidden'));
    document.getElementById('tab-admin').classList.remove('hidden');
  }
  document.getElementById('stat-user').textContent = found.username;
  document.getElementById('sheets-url-display').textContent = SHEETS_URL;
  initApp();
}

function doLogout() {
  currentUser = null;
  pauseList = []; historyList = [];
  clearInterval(timerInterval);
  clearInterval(pollInterval);
  document.getElementById('page-app').style.display = 'none';
  document.getElementById('page-login').style.display = 'flex';
  document.getElementById('login-user').value = '';
  document.getElementById('login-pass').value = '';
  document.getElementById('login-error').textContent = '';
  document.getElementById('btn-admin-tab').classList.add('hidden');
  document.querySelectorAll('[data-tab="admin"]').forEach(el => el.classList.add('hidden'));
  document.getElementById('tab-admin').classList.add('hidden');
  switchTab('send');
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// INIT
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function initApp() {
  Object.assign(agentsDB, DEMO); // base dÃ©mo par dÃ©faut
  fetchAgents();
  fetchPauses();
  startPolling();
  renderCapacity();
  renderDashboard();
  renderHistory();
  renderUserList();
  clearInterval(timerInterval);
  timerInterval = setInterval(tick, 1000);
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// TABS
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function switchTab(name) {
  document.querySelectorAll('.tab').forEach(t => t.classList.toggle('active', t.dataset.tab === name));
  document.querySelectorAll('.tab-content').forEach(c => c.classList.toggle('active', c.id === 'tab-' + name));
  if (name === 'admin') { renderUserList(); updateStats(); }
  if (name === 'history') renderHistory();
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// SYNC STATUS DOT
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function setSyncStatus(state) {
  let dot = document.getElementById('sync-dot');
  if (!dot) {
    dot = document.createElement('div');
    dot.id = 'sync-dot';
    dot.style.cssText = 'font-size:11px;font-weight:700;letter-spacing:1px;padding:8px 12px;border:1px solid;transition:all 0.3s;text-transform:uppercase;';
    document.querySelector('.header-right').prepend(dot);
  }
  const s = { ok: ['â¬¤ SYNC', 'var(--green)'], syncing: ['âŸ³ SYNC', 'var(--warn)'], err: ['â¬¤ HORS LIGNE', 'var(--accent)'] }[state];
  dot.textContent = s[0];
  dot.style.color = s[1];
  dot.style.borderColor = s[1];
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// SHEETS â€” AGENTS
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
async function fetchAgents() {
  try {
    const res = await fetch(SHEETS_URL + '?action=getAgents&t=' + Date.now());
    const data = await res.json();
    if (Array.isArray(data) && data.length > 0) {
      agentsDB = {};
      data.forEach(r => {
        if (r.matricule) agentsDB[String(r.matricule).trim()] = { nom: r.nom || 'â€”', equipe: r.equipe || 'â€”' };
      });
      document.getElementById('stat-agents').textContent = Object.keys(agentsDB).length;
      notify('âœ“ ' + Object.keys(agentsDB).length + ' agents chargÃ©s', 'ok');
    }
  } catch(e) {
    notify('âš  Base agents : mode dÃ©mo actif', 'warn');
  }
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// SHEETS â€” PAUSES
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
async function fetchPauses() {
  setSyncStatus('syncing');
  try {
    const res  = await fetch(SHEETS_URL + '?action=getPauses&t=' + Date.now());
    const data = await res.json();
    if (!Array.isArray(data)) throw new Error('rÃ©ponse invalide');

    // Convertit la date texte Sheets "dd/mm/yyyy hh:mm:ss" â†’ timestamp ms
    function sheetsDateToTs(str) {
      if (!str) return Date.now();
      // Format: 25/02/2026 15:12:44
      const m = str.match(/(\d{2})\/(\d{2})\/(\d{4}) (\d{2}):(\d{2}):(\d{2})/);
      if (!m) return Date.now();
      return new Date(m[3], m[2]-1, m[1], m[4], m[5], m[6]).getTime();
    }

    // Merge â€” prÃ©serve les startTime locaux si l'entrÃ©e existe dÃ©jÃ 
    pauseList = data.map(row => {
      const existing = pauseList.find(p => String(p.id) === String(row.id));
      return {
        id:        String(row.id),
        matricule: row.matricule,
        nom:       row.nom,
        equipe:    row.equipe,
        note:      row.note || '',
        startTime: existing ? existing.startTime : sheetsDateToTs(row.startTime)
      };
    });

    renderCapacity();
    renderDashboard();
    updateStats();
    setSyncStatus('ok');
  } catch(e) {
    setSyncStatus('err');
  }
}

function startPolling() {
  clearInterval(pollInterval);
  pollInterval = setInterval(fetchPauses, POLL_MS);
}

async function pushPause(entry) {
  setSyncStatus('syncing');
  try {
    const p = new URLSearchParams({
      action:    'addPause',
      id:        String(entry.id),
      matricule: entry.matricule,
      nom:       entry.nom,
      equipe:    entry.equipe,
      note:      entry.note || '',
      startTime: String(entry.startTime)
    });
    await fetch(SHEETS_URL + '?' + p.toString());
    setSyncStatus('ok');
    return true;
  } catch(e) { setSyncStatus('err'); return false; }
}

// Met Ã  jour Statut â†’ "TerminÃ©" + heure de fin dans Sheets
async function callRemovePause(id, finStr) {
  setSyncStatus('syncing');
  try {
    const p = new URLSearchParams({
      action: 'removePause',
      id:     String(id),
      fin:    finStr || ''
    });
    await fetch(SHEETS_URL + '?' + p.toString());
    setSyncStatus('ok');
    return true;
  } catch(e) { setSyncStatus('err'); return false; }
}


// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// MATRICULE INPUT
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function onMatriculeInput(val) {
  const mat = val.trim();
  const preview = document.getElementById('preview-agent');
  const btn     = document.getElementById('btn-send');
  const warn    = document.getElementById('send-warning');

  if (!mat) { preview.classList.remove('visible'); btn.disabled = true; warn.textContent = ''; return; }
  if (pauseList.find(p => String(p.matricule) === mat)) {
    preview.classList.remove('visible'); btn.disabled = true;
    warn.textContent = 'âš  Cet agent est dÃ©jÃ  en pause.'; return;
  }
  if (pauseList.length >= MAX_PAUSE) {
    preview.classList.remove('visible'); btn.disabled = true;
    warn.textContent = 'â›” Maximum 5 agents en pause atteint.'; return;
  }
  const agent = agentsDB[mat];
  if (agent) {
    document.getElementById('preview-name').textContent = agent.nom;
    document.getElementById('preview-info').textContent = 'Matricule : ' + mat + '  â€”  ' + agent.equipe;
    preview.classList.add('visible');
    btn.disabled = false;
    warn.textContent = '';
  } else {
    preview.classList.remove('visible'); btn.disabled = true;
    warn.textContent = 'âœ• Matricule introuvable.';
  }
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// SEND PAUSE
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
async function sendPause() {
  const mat  = document.getElementById('input-matricule').value.trim();
  const note = document.getElementById('input-note').value.trim();
  if (!mat || pauseList.length >= MAX_PAUSE) return;
  const agent = agentsDB[mat];
  if (!agent) return;

  const entry = { id: Date.now(), matricule: mat, nom: agent.nom, equipe: agent.equipe, note, startTime: Date.now() };

  // Optimistic update
  pauseList.push(entry);
  document.getElementById('input-matricule').value = '';
  document.getElementById('input-note').value = '';
  document.getElementById('preview-agent').classList.remove('visible');
  document.getElementById('btn-send').disabled = true;
  document.getElementById('send-warning').textContent = '';
  renderCapacity();
  renderDashboard();
  updateStats();
  notify('âœ“ ' + agent.nom + ' envoyÃ©(e) en pause');

  const ok = await pushPause(entry);
  if (!ok) notify('âš  Erreur de sync â€” rÃ©essai dans 5s', 'warn');
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// RECALL (RETOUR)
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function recallAgent(id) {
  const sid = String(id);
  const p = pauseList.find(x => String(x.id) === sid);
  if (!p) { notify('Agent introuvable â€” liste dÃ©jÃ  Ã  jour', 'warn'); return; }

  const snapNow = Date.now();
  const snapElapsed = Math.floor((snapNow - p.startTime) / 1000);

  // Affiche modale de confirmation â€” le callback est async
  document.getElementById('modal-title').textContent = 'CONFIRMER LE RETOUR';
  document.getElementById('modal-body').innerHTML =
    '<span style="font-size:18px;font-weight:700;color:#fff;display:block;margin-bottom:10px;">' + p.nom + '</span>' +
    '<span style="color:#c0c0e0;font-size:13px;">Matricule : ' + p.matricule + ' â€” ' + p.equipe + '</span><br><br>' +
    '<span style="font-size:20px;font-weight:800;color:#3dffa0;">â± ' + fmt(snapElapsed) + '</span><br>' +
    '<span style="color:#c0c0e0;font-size:12px;">DÃ©part : ' + fmtDT(p.startTime) + '</span><br><br>' +
    '<span style="color:#ffd040;font-weight:600;">Confirmer le retour de cet agent ?</span>';
  document.getElementById('modal').classList.add('open');

  // Lier le bouton CONFIRMER directement Ã  l'action async
  document.getElementById('modal-confirm').onclick = async function() {
    // Fermer la modale EN PREMIER
    document.getElementById('modal').classList.remove('open');

    const now = Date.now();
    const elapsed = Math.floor((now - p.startTime) / 1000);

    // Retirer de la liste active
    pauseList = pauseList.filter(x => String(x.id) !== sid);
    historyList.unshift({ ...p, endTime: now, duration: elapsed });

    // Mettre Ã  jour l'UI
    renderCapacity();
    renderDashboard();
    renderHistory();
    updateStats();
    onMatriculeInput(document.getElementById('input-matricule').value);
    notify('â†© ' + p.nom + ' â€” retour confirmÃ© (' + fmt(elapsed) + ')', 'warn');

    // Couper le polling le temps du sync
    clearInterval(pollInterval);

    // Sync vers Sheets
    const ok = await callRemovePause(sid, fmtSheets(now));
    if (!ok) notify('âš  Erreur sync Sheets â€” vÃ©rifiez la connexion', 'err');

    // Relancer le polling
    startPolling();
  };
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// RENDER
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function renderCapacity() {
  const bar = document.getElementById('capacity-bar');
  bar.innerHTML = '';
  for (let i = 1; i <= MAX_PAUSE; i++) {
    const d = document.createElement('div');
    d.className = 'cap-dot' + (i <= pauseList.length ? ' used' : '');
    d.textContent = i;
    bar.appendChild(d);
  }
  const lbl = document.createElement('div');
  lbl.className = 'cap-label';
  lbl.textContent = pauseList.length + ' / 5 en pause';
  bar.appendChild(lbl);
  document.getElementById('hdr-count').textContent = pauseList.length;
}

function renderDashboard() {
  const c = document.getElementById('dash-list');
  if (pauseList.length === 0) {
    c.innerHTML = '<div class="dash-empty"><div class="big">â˜•</div>Aucun agent en pause</div>';
    return;
  }
  c.innerHTML = '<div class="agent-list">' + pauseList.map(p => {
    const elapsed = Math.floor((Date.now() - p.startTime) / 1000);
    const cls = elapsed >= 900 ? 'overtime' : elapsed >= 720 ? 'warning' : '';
    return `<div class="agent-card ${cls}" id="card-${p.id}">
      <div class="agent-left">
        <div class="agent-num">MATRICULE ${p.matricule}</div>
        <div class="agent-name">${p.nom}</div>
        <div class="agent-meta">${p.equipe}${p.note ? ' â€” ' + p.note : ''}</div>
        <div class="agent-timestamps">DÃ©part en pause : ${fmtDT(p.startTime)}</div>
      </div>
      <div class="agent-right">
        <div class="agent-timer">
          <div class="timer-label">DurÃ©e</div>
          <div class="timer-value ${cls}" id="timer-${p.id}">${fmt(elapsed)}</div>
        </div>
        <button class="btn-recall" onclick="recallAgent('${p.id}')">âœ“ RETOUR</button>
      </div>
    </div>`;
  }).join('') + '</div>';
}

function renderHistory() {
  const c = document.getElementById('history-list');
  if (historyList.length === 0) {
    c.innerHTML = '<div class="dash-empty"><div class="big">ğŸ“‹</div>Aucune pause terminÃ©e cette session</div>';
    return;
  }
  c.innerHTML = '<div class="history-list">' + historyList.map(p => `
    <div class="history-card">
      <div class="history-left">
        <div class="history-name">${p.nom} <span style="font-size:12px;font-weight:500;color:var(--text-dim)">â€” MAT. ${p.matricule}</span></div>
        <div class="history-meta">${p.equipe}${p.note ? ' â€” ' + p.note : ''}</div>
        <div class="history-times">
          â–¶ DÃ©part : ${fmtDT(p.startTime)}&nbsp;&nbsp;&nbsp;â—¼ Retour : ${fmtDT(p.endTime)}
        </div>
      </div>
      <div class="history-right">
        <div class="history-label">DurÃ©e totale</div>
        <div class="history-duration">${fmt(p.duration)}</div>
      </div>
    </div>`).join('') + '</div>';
}

function tick() {
  pauseList.forEach(p => {
    const e   = Math.floor((Date.now() - p.startTime) / 1000);
    const cls = e >= 900 ? 'overtime' : e >= 720 ? 'warning' : '';
    const te  = document.getElementById('timer-' + p.id);
    const ce  = document.getElementById('card-'  + p.id);
    if (te) { te.textContent = fmt(e); te.className = 'timer-value ' + cls; }
    if (ce) ce.className = 'agent-card ' + cls;
  });
}

// Format dd/mm/yyyy hh:mm:ss pour Google Sheets
function fmtSheets(ts) {
  const d = new Date(ts);
  const pad = n => String(n).padStart(2,'0');
  return pad(d.getDate())+'/'+pad(d.getMonth()+1)+'/'+d.getFullYear()
    +' '+pad(d.getHours())+':'+pad(d.getMinutes())+':'+pad(d.getSeconds());
}

function fmt(s) {
  return String(Math.floor(s / 60)).padStart(2, '0') + ':' + String(s % 60).padStart(2, '0');
}
function fmtDT(ts) {
  const d = new Date(ts);
  return d.toLocaleDateString('fr-CA', { day: '2-digit', month: '2-digit' }) + ' ' +
         d.toLocaleTimeString('fr-CA', { hour: '2-digit', minute: '2-digit', second: '2-digit' });
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// ADMIN â€” USERS
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function renderUserList() {
  document.getElementById('user-list').innerHTML = getUsers().map((u, i) => `
    <div class="user-item">
      <div><strong>${u.username}</strong><div class="user-role">${u.role}</div></div>
      ${u.username !== 'admin'
        ? `<button class="btn-del" onclick="deleteUser(${i})">âœ•</button>`
        : '<span style="font-size:10px;color:var(--text-dimmer)">PROTÃ‰GÃ‰</span>'}
    </div>`).join('');
}

function addUser() {
  const un = document.getElementById('new-username').value.trim();
  const pw = document.getElementById('new-password').value;
  if (!un || !pw) { notify('Remplissez tous les champs', 'err'); return; }
  const users = getUsers();
  if (users.find(u => u.username === un)) { notify('Utilisateur dÃ©jÃ  existant', 'err'); return; }
  users.push({ username: un, password: pw, role: 'user' });
  saveUsers(users);
  document.getElementById('new-username').value = '';
  document.getElementById('new-password').value = '';
  renderUserList();
  notify('âœ“ Utilisateur ' + un + ' ajoutÃ©');
}

function deleteUser(idx) {
  const users = getUsers();
  const u = users[idx];
  if (!u || u.username === 'admin') return;
  openModal('SUPPRIMER ' + u.username.toUpperCase(), 'Cet utilisateur sera supprimÃ© dÃ©finitivement.', () => {
    users.splice(idx, 1);
    saveUsers(users);
    renderUserList();
    notify('Utilisateur supprimÃ©', 'warn');
  });
}

function updateStats() {
  document.getElementById('stat-count').textContent = pauseList.length;
  document.getElementById('stat-total').textContent = historyList.length;
  document.getElementById('stat-agents').textContent = Object.keys(agentsDB).length;
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// MODAL
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function openModal(title, body, cb) {
  document.getElementById('modal-title').textContent = title;
  document.getElementById('modal-body').innerHTML = body.replace(/\n/g, '<br>');
  modalCb = cb;
  document.getElementById('modal').classList.add('open');
  document.getElementById('modal-confirm').onclick = () => { closeModal(); if (modalCb) modalCb(); };
}
function closeModal() { document.getElementById('modal').classList.remove('open'); modalCb = null; }

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// NOTIFICATIONS
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function notify(msg, type = 'ok') {
  const el = document.createElement('div');
  el.className = 'notif ' + type;
  el.textContent = msg;
  document.body.appendChild(el);
  setTimeout(() => el.remove(), 3500);
}
</script>
</body>
</html>
